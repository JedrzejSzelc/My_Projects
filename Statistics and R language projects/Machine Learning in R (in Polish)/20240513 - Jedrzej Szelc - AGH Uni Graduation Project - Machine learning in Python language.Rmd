---
title: "Spis treści"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 4
---

---
title: "Zaliczenie przedmiotu 'Machine Learning'"
subtitle: "Studia podyplomowe: 'Metody Statystycznej Analizy Danych - edycja IX'"
author: "Jędrzej Szelc"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

***

# 1. Wstęp

***

## 1.1. Treść zadania

Wybieram zadanie numer 2.

Treść zadania:

*"Na podstawie wybranego zestawu danych dokonać wstępnej analizy danych (EDA), a następnie z wykorzystaniem trzech wybranych technik (m.in. kNN, nB, regresja logistyczna, drzewa decyzyjne, lasy losowe itp.) zbudować model prognostyczny. W ramach sprawozdania zwrócić uwagę na: podział danych na zbiór uczący i testowy (walidacja krzyżowa), dokonać optymalizacji hiperparametrów, na podstawy odpowiednich indeksów opisać wyniki i zdecydować się, który z modeli jest najskuteczniejszy."*

***

## 1.2. Konfiguracja wstępna

```{r}
### Import bibliotek i modułów:
library(dplyr)
library(ggplot2)
library(class)
library(caret)
library(kknn)
library(rpart)
library(randomForest)

### Konfiguracja grafiki:
string_kolor_punktu_danych_na_wykresach <- "steelblue"
integer_rozmiar_punktu_danych_na_wykresach <- 1

### Funkcje pomocnicze:
funkcja_konwersja_wartosci_wektora_na_procenty <- function(wektor_wejsciowy, integer_zaokraglenie)
{
  wektor_przeznaczenie_kredytu_wszystkie_wartosci <- 
    round(wektor_wejsciowy/
            sum(wektor_wejsciowy) * 100 , integer_zaokraglenie)
}
```

***

# 2. Dane oraz EDA

W niniejszym rozdziale przeprowadzone zostaną import, wstępna obróbka oraz Eksploracyjna Analiza Danych (EDA).

Do budowy modelu wybieram dane niemieckich kredytobiorców - plik: *"german_credit_data.csv"*.

***

## 2.1. Import danych
```{r}
string_plik_z_danymi <- "german_credit_data.csv"
string_sciezka_dostepu <- getwd()
string_sciezka_dostepu <- paste0(string_sciezka_dostepu, "/", 
                                 string_plik_z_danymi)
df_dane <- read.csv(string_sciezka_dostepu, sep=";", 
                    stringsAsFactors=TRUE)
```

***

## 2.2. Wstępna obróbka danych
```{r}
### Usuwam dane niepełne (czyli dane, które mogą gdziekolwiek zawierać wartości N/A):
df_dane <- na.omit(df_dane)

### Spoglądam wstępnie na dane:
head(df_dane)
summary(df_dane)
str(df_dane)

### Zmiana nazw kolumn ramki danych:
colnames(df_dane) <- c("Wiek", 
                       "Płeć", 
                       "Zatrudnienie", 
                       "Nieruchomości",
                       "Rachunek_oszczędnościowy",
                       "Rachunek_bieżący",
                       "Wysokość_kredytu",
                       "Okres_kredytowania",
                       "Przeznaczenie_kredytu")

### Zmiana poziomów zmiennych typu "factor" w ramce danych:
levels(df_dane$Płeć) <- c("Kobieta", "Mężczyzna")
levels(df_dane$Rachunek_oszczędnościowy) <- c("Niskie", 
                                              "Umiarkowane", 
                                              "Średniowysokie",
                                              "Wysokie")

levels(df_dane$Rachunek_bieżący) <- c("Niskie", 
                                      "Umiarkowane", 
                                      "Wysokie")

levels(df_dane$Nieruchomości) <- c("Socjalne",
                                   "Własnościowe",
                                   "Najem")

levels(df_dane$Przeznaczenie_kredytu) <- c("Biznes",
                                           "Samochód",
                                           "AGD",
                                           "Edukacja",
                                           "Meble",
                                           "RTV",
                                           "Remont",
                                           "Wakacje")
```

***

## 2.3. EDA

W kolejnych podsekcjach eksploruję zależności danej zmiennej od pozostałych.

***

### 2.3.1. Wiek
```{r}
### Wiek kredytobiorców bez podziału na płeć:
df_dane %>%
  ggplot() +
  geom_histogram(aes(x = Wiek), 
                 fill = "steelblue",
                 colour = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład wieku kredytobiorców bez podziału na płeć", 
       x = "Wiek [Lata]", y = "Występowanie") + 
  scale_x_continuous(breaks=seq(18, 78, by=3))

df_dane %>%
  ggplot() +
  geom_density(aes(x = Wiek), 
               fill = "steelblue",
               colour = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład wieku kredytobiorców bez podziału na płeć", 
       x = "Wiek [Lata]", y = "Występowanie") + 
  scale_x_continuous(breaks=seq(18, 78, by=3))

df_dane %>%
  ggplot() +
  geom_boxplot(aes(y = Wiek),
               fill = "steelblue",
               colour = "black") +
  theme_bw() +
  labs(title = "20240508 - Wiek Kredytobiorców bez podziału na płeć",
       y = "Wiek [lata]") + 
  scale_y_continuous(breaks=seq(18, 78, by=3))

### Nieruchomości, a wiek:
df_dane %>%
  ggplot() +
  geom_histogram(aes(x = Wiek, fill = Nieruchomości), 
                 alpha = 0.75, position = "dodge",
                 colour = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład wieku Kredytobiorców z uwzględnieniem ich sytuacji mieszkaniowej oraz płci",
       x = "Wiek [Lata]", y = "Występowanie", fill="Legenda:")

df_dane %>%
  ggplot() +
  geom_density(aes(x = Wiek, fill = Nieruchomości), 
                 alpha = 0.75, 
                 colour = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład wieku Kredytobiorców z uwzględnieniem ich sytuacji mieszkaniowej oraz płci",
       x = "Wiek [Lata]", y = "Występowanie", fill="Legenda:")

df_dane %>%
  ggplot() +
  geom_jitter(aes(x = Wiek, y = Nieruchomości, col = Płeć),
              height = 0.2, 
              size = integer_rozmiar_punktu_danych_na_wykresach) +
  theme_bw() +
  labs(title = "20240508 - Sytuacja mieszkaniowa Kredytobiorców = f(Wiek)", 
       x = "Wiek [lata]", y = "Typ nieruchomości",
       col = "Legenda:")

df_dane %>%
  ggplot() +
  geom_boxplot(aes(y = Wiek, fill = Nieruchomości)) +
  theme_bw() +
  labs(title = "20240508 - Wiek Kredytobiorców, a ich sytuacja mieszkaniowa",
       x = "Sytuacja mieszkaniowa", y = "Wiek [lata]", fill = "Legenda:")
```

***

### 2.3.2. Płeć
```{r}
### Płeć badanych:
wektor_kobiety_meczyzni_w_badanej_probie <- table(df_dane$Płeć)
names(wektor_kobiety_meczyzni_w_badanej_probie) <- c("Kobiety [Liczba]",
                                                     "Mężczyni [Liczba]")
wektor_procent_kobiety_mezczyzni_w_badanej_probie <- 
  funkcja_konwersja_wartosci_wektora_na_procenty(wektor_kobiety_meczyzni_w_badanej_probie,1)
names(wektor_procent_kobiety_mezczyzni_w_badanej_probie) <- c("Kobiety [%]",
                                                              "Mężczyni [%]")
wektor_kobiety_meczyzni_w_badanej_probie
wektor_procent_kobiety_mezczyzni_w_badanej_probie

### Płeć, a wiek:
df_dane %>%
  ggplot() +
  geom_histogram(aes(x = Wiek, fill = Płeć), 
                 alpha = 0.75, position = "dodge",
                 colour = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład wieku Kredytobiorców z podziałem na płeć", 
       x = "Wiek [Lata]", y = "Występowanie", fill="Legenda:")

df_dane %>%
  ggplot() +
  geom_density(aes(x = Wiek, fill = Płeć), 
               alpha = 0.75,
               colour = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład wieku Kredytobiorców z podziałem na płeć", 
       x = "Wiek [Lata]", y = "Występowanie", fill="Legenda:")

df_dane %>%
  ggplot() +
  geom_boxplot(aes(y = Wiek, fill = Płeć)) +
  theme_bw() +
  labs(title = "20240508 - Rozkład wieku Kredytobiorców z podziałem na płeć", 
       x = "Płeć", y = "Wiek [lata]", fill = "Legenda:") + 
  scale_y_continuous(breaks=seq(18, 78, by=3))

### Płeć, a zatrudnienie:
df_dane %>%
  ggplot() +
  geom_density(aes(x = Zatrudnienie, fill = Płeć), 
               alpha = 0.75,
               colour = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład zatrudnienia Kredytobiorców z podziałem na płeć", 
       x = "Zatrudnienie", y = "Występowanie", fill="Legenda:")

### Płeć, a sytuacja mieszkaniowa:
table(df_dane$Nieruchomości, df_dane$Płeć)

df_dane %>%
  ggplot() +
  geom_jitter(aes(x = Nieruchomości, y = Płeć),
              height = 0.2, 
              color = string_kolor_punktu_danych_na_wykresach,
              size = integer_rozmiar_punktu_danych_na_wykresach) +
  theme_bw() +
  labs(title = "20240508 - Zależność płci Kredytobiorców od ich sytuacji mieszkaniowej",
       y = "Płeć", x = "Typ nieruchomości",
       col = "Legenda:")

### Płeć, a oszczędności:
table(df_dane$Rachunek_oszczędnościowy, df_dane$Płeć)

df_dane %>%
  ggplot() +
  geom_jitter(aes(x = Rachunek_oszczędnościowy, y = Płeć),
              height = 0.2, 
              color = string_kolor_punktu_danych_na_wykresach,
              size = integer_rozmiar_punktu_danych_na_wykresach) +
  theme_bw() +
  labs(title = "20240508 - Zależność płci Kredytobiorców od wysokości ich oszczędności",
       y = "Płeć", x = "Oszczędności",
       col = "Legenda:")

### Płeć, a rachunek bieżący:
table(df_dane$Rachunek_bieżący, df_dane$Płeć)

df_dane %>%
  ggplot() +
  geom_jitter(aes(x = Rachunek_bieżący, y = Płeć),
              height = 0.2, 
              color = string_kolor_punktu_danych_na_wykresach,
              size = integer_rozmiar_punktu_danych_na_wykresach) +
  theme_bw() +
  labs(title = "20240508 - Zależność płci Kredytobiorców od salda ich rachunku bieżącego",
       y = "Płeć", x = "Saldo rachunku bieżącego",
       col = "Legenda:")

### Płeć, a wysokość kredytu:
df_dane %>%
  ggplot() +
  geom_jitter(aes(x = Wysokość_kredytu, y = Płeć),
              height = 0.2, 
              color = string_kolor_punktu_danych_na_wykresach,
              size = integer_rozmiar_punktu_danych_na_wykresach) +
  theme_bw() +
  labs(title = "20240508 - Zależność płci Kredytobiorców od wysokości kredytu",
       y = "Płeć", x = "Wysokość kredytu [EUR]",
       col = "Legenda:")

df_dane %>%
  ggplot() +
  geom_density(aes(x = Wysokość_kredytu, fill = Płeć), 
               alpha = 0.75,
               colour = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład wysokości kredytów z podziałem na płeć",
       x = "Wysokość kredytu [EUR]", y = "Występowanie", fill="Legenda:")

### Płeć, a okres kredytowania:
df_dane %>%
  ggplot() +
  geom_jitter(aes(x = Okres_kredytowania, y = Płeć),
              height = 0.2, 
              color = string_kolor_punktu_danych_na_wykresach,
              size = integer_rozmiar_punktu_danych_na_wykresach) +
  theme_bw() +
  labs(title = "20240508 - Zależność płci Kredytobiorców od okresu kredytowania",
       y = "Płeć", x = "Okres kredytowania [miesiące]",
       col = "Legenda:") + scale_x_continuous(breaks=seq(3, 78, by=6))

df_dane %>%
  ggplot() +
  geom_density(aes(x = Okres_kredytowania, fill = Płeć), 
               alpha = 0.75,
               colour = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład okresów kredytowania z podziałem na płeć",
       x = "Okres kredytowania [miesiące]", y = "Występowanie", fill="Legenda:") +
  scale_x_continuous(breaks=seq(3, 78, by=6))

### Płeć, a przeznaczenie kredytu:
table(df_dane$Przeznaczenie_kredytu, df_dane$Płeć)

df_dane %>%
  ggplot() +
  geom_jitter(aes(x = Przeznaczenie_kredytu, y = Płeć),
              height = 0.2, 
              color = string_kolor_punktu_danych_na_wykresach,
              size = integer_rozmiar_punktu_danych_na_wykresach) +
  theme_bw() +
  labs(title = "20240508 - Zależność płci Kredytobiorców od przeznaczenia kredytów",
       y = "Płeć", x = "Przeznaczenie kredytu",
       col = "Legenda:")
```

***

### 2.3.3. Nieruchomości
```{r}
### Nieruchomości, a oszczędności:
df_dane %>%
  ggplot() +
  geom_jitter(aes(x = Rachunek_oszczędnościowy, y = Nieruchomości, col = Płeć),
              height = 0.2, 
              size = integer_rozmiar_punktu_danych_na_wykresach) +
  theme_bw() +
  labs(title = "20240508 - Sytuacja mieszkaniowa Kredytobiorców = f(Oszczędności)", 
       x = "Oszczędności", y = "Typ nieruchomości",
       col = "Legenda:")

### Nieruchomości, a wysokość zadłużenia:
df_dane %>%
  ggplot() +
  geom_jitter(aes(x = Wysokość_kredytu, y = Nieruchomości, col = Płeć),
              height = 0.2, 
              size = integer_rozmiar_punktu_danych_na_wykresach) +
  theme_bw() +
  labs(title = "20240508 - Sytuacja mieszkaniowa Kredytobiorców = f(Wysokość zadłużenia)", 
       x = "Wysokość zadłużenia [EUR]", y = "Typ nieruchomości",
       col = "Legenda:")

df_dane %>%
  ggplot() +
  geom_boxplot(aes(y = Wysokość_kredytu, fill = Nieruchomości)) +
  theme_bw() +
  labs(title = "20240508 - Wysokość zadłużenia Kredytobiorców, a ich sytuacja mieszkaniowa",
       x = "Sytuacja mieszkaniowa", y = "Wysokość zadłużenia [EUR]", fill = "Legenda:")
```

***

### 2.3.4. Oszczędności
```{r}
### Wysokość oszczędności - bez podziału na płeć:
wektor_wysokosc_oszczednosci_w_badanej_probie <- table(df_dane$Rachunek_oszczędnościowy)
names(wektor_wysokosc_oszczednosci_w_badanej_probie) <- c("Niskie [Liczba]",
                                                          "Umiarkowane [Liczba]",
                                                          "Średniowysokie [Liczba]",
                                                          "Wysokie [Liczba]")
wektor_wysokosc_oszczednosci_w_badanej_probie_procenty <- 
  funkcja_konwersja_wartosci_wektora_na_procenty(wektor_wysokosc_oszczednosci_w_badanej_probie,1)
names(wektor_wysokosc_oszczednosci_w_badanej_probie_procenty) <- c("Niskie [%]",
                                                              "Umiarkowane [%]",
                                                              "Średniowysokie [%]",
                                                              "Wysokie [%]")
wektor_wysokosc_oszczednosci_w_badanej_probie
wektor_wysokosc_oszczednosci_w_badanej_probie_procenty

df_dane %>%
  ggplot() +
  geom_jitter(aes(x = Wiek, y = Rachunek_oszczędnościowy),
              color = string_kolor_punktu_danych_na_wykresach,
              height = 0.2,
              size = integer_rozmiar_punktu_danych_na_wykresach) +
  theme_bw() +
  labs(title = "20240508 - Wysokość oszczędności = f(Wiek)", 
       x = "Wiek [lata]", y = "Wysokość oszczędności")

### Wysokość oszczędności - z podziałem na płeć:
df_dane %>%
  ggplot() +
  geom_jitter(aes(x = Wiek, y = Rachunek_oszczędnościowy, col = Płeć),
              height = 0.2, 
              size = integer_rozmiar_punktu_danych_na_wykresach) +
  theme_bw() +
  labs(title = "20240508 - Wysokość oszczędności = f(Wiek)", 
       x = "Wiek [lata]", y = "Wysokość oszczędności",
       col = "Legenda:")

df_dane %>%
  ggplot() +
  geom_histogram(aes(x = Wiek, fill = Rachunek_oszczędnościowy), 
                 alpha = 0.75, position = "dodge",
                 colour = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład wieku Kredytobiorców z podziałem na grupy oszczędności",
       x = "Wiek [Lata]", y = "Występowanie", fill="Legenda:")
```

***

### 2.3.5. Saldo bieżące
```{r}
### Rachunek bieżący - bez podziału na płeć:
wektor_saldo_biezace_w_badanej_probie <- table(df_dane$Rachunek_bieżący)
names(wektor_saldo_biezace_w_badanej_probie) <- c("Niskie [Liczba]",
                                                  "Umiarkowane [Liczba]",
                                                  "Wysokie [Liczba]")
wektor_saldo_biezace_w_badanej_probie_procenty <- 
  funkcja_konwersja_wartosci_wektora_na_procenty(wektor_saldo_biezace_w_badanej_probie,1)
names(wektor_saldo_biezace_w_badanej_probie_procenty) <- c("Niskie [%]",
                                                           "Umiarkowane [%]",
                                                           "Wysokie [%]")
wektor_saldo_biezace_w_badanej_probie
wektor_saldo_biezace_w_badanej_probie_procenty

df_dane %>%
  ggplot() +
  geom_jitter(aes(x = Wiek, y = Rachunek_bieżący),
              color = string_kolor_punktu_danych_na_wykresach,
              height = 0.2, 
              size = integer_rozmiar_punktu_danych_na_wykresach) +
  theme_bw() +
  labs(title = "20240508 - Saldo rachunku bieżącego = f(Wiek)", 
       x = "Wiek [lata]", y = "Saldo rachunku bieżącego")

df_dane %>%
  ggplot() +
  geom_histogram(aes(x = Wiek, fill = Rachunek_bieżący), 
                 alpha = 0.75, position = "dodge",
                 colour = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład wieku Kredytobiorców z podziałem na salda rachunków bieżących",
       x = "Wiek [Lata]", y = "Występowanie", fill="Legenda:")

### Rachunek bieżący - z podziałem na płeć:
df_dane %>%
  ggplot() +
  geom_jitter(aes(x = Wiek, y = Rachunek_bieżący, col = Płeć),
              height = 0.2, 
              size = integer_rozmiar_punktu_danych_na_wykresach) +
  theme_bw() +
  labs(title = "20240508 - Saldo rachunku bieżącego = f(Wiek)", 
       x = "Wiek [lata]", y = "Saldo rachunku bieżącego",
       col = "Legenda:")
```

***

### 2.3.6. Wysokość kredytu
```{r}
### Wysokość kredytu - bez podziału na płeć:
df_dane %>%
  ggplot() +
  geom_histogram(aes(x = Wysokość_kredytu), 
                 fill = string_kolor_punktu_danych_na_wykresach,
                 colour = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład wysokości kredytów bez podziału na płeć", 
       x = "Wysokość kredytu [EUR]", y = "Występowanie")

df_dane %>%
  ggplot() +
  geom_point(aes(x = Wiek, y = Wysokość_kredytu), 
             color = string_kolor_punktu_danych_na_wykresach,
             size = integer_rozmiar_punktu_danych_na_wykresach) + 
  theme_bw() +
  labs(title = "20240508 - Wysokość kredytu bez podziału na płeć = f(Wiek)", 
       x = "Wiek [lata]", y = "Wysokość kredytu bez podziału na płeć [EUR]")

df_dane %>%
  ggplot() +
  geom_boxplot(aes(y = Wysokość_kredytu),
               fill = string_kolor_punktu_danych_na_wykresach,
               color = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład wysokości zadłużenia bez podziału na płeć Kredytobiorców",
       y = "Wysokość zadłużenia [EUR]")

### Wysokość kredytu - z podziałem na płeć:
df_dane %>%
  ggplot() +
  geom_histogram(aes(x = Wysokość_kredytu, fill = Płeć), 
                 alpha = 0.75, position = "dodge",
                 colour = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład wysokości kredytów z podziałem na płeć", 
       x = "Wysokość kredytu [EUR]", y = "Występowanie", fill="Legenda:")

df_dane %>%
  ggplot() +
  geom_density(aes(x = Wysokość_kredytu, fill = Płeć), 
               alpha = 0.75,
               colour = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład wysokości kredytów z podziałem na płeć", 
       x = "Wysokość kredytu [EUR]", y = "Występowanie", fill="Legenda:")

df_dane %>%
  ggplot() +
  geom_point(aes(x = Wiek, y = Wysokość_kredytu, col = Płeć), 
             size = integer_rozmiar_punktu_danych_na_wykresach) + 
  theme_bw() +
  labs(title = "20240508 - Wysokość kredytu z podziałem na płeć = f(Wiek)", 
       x = "Wiek [lata]", y = "Wysokość kredytu z podziałem na płeć [EUR]",
       col = "Legenda:")

df_dane %>%
  ggplot() +
  geom_boxplot(aes(y = Wysokość_kredytu, fill = Płeć)) +
  theme_bw() +
  labs(title = "20240508 - Rozkład wysokości zadłużenia z podziałem na płeć Kredytobiorców",
       x = "Płeć", y = "Wysokość zadłużenia [EUR]", fill = "Legenda:")

### Wysokość kredytu, a jego przeznaczenie:
df_dane %>%
  ggplot() +
  geom_histogram(aes(x = Wysokość_kredytu, fill = Przeznaczenie_kredytu), 
                 alpha = 0.75, position = "dodge",
                 colour = "black", bins = 5) +
  theme_bw() +
  labs(title = "20240508 - Rozkład wysokości kredytu z podziałem na jego przeznaczenie", 
       x = "Wysokość kredytu [EUR]", y = "Występowanie", fill="Legenda:")

df_dane %>%
  ggplot() +
  geom_density(aes(x = Wysokość_kredytu, fill = Przeznaczenie_kredytu), 
               alpha = 0.25,
               colour = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład wysokości kredytu z podziałem na jego przeznaczenie", 
       x = "Wysokość kredytu [EUR]", y = "Występowanie", fill="Legenda:")

df_dane %>%
  ggplot() +
  geom_jitter(aes(x = Wysokość_kredytu, y = Przeznaczenie_kredytu, col = Płeć),
              height = 0.2, 
              size = integer_rozmiar_punktu_danych_na_wykresach) +
  theme_bw() +
  labs(title = "20240508 - Przeznaczenie kredytu= f(Wiek)", 
       x = "Wysokość kredytu [EUR]", y = "Przeznaczenie", col = "Legenda:")

df_dane %>%
  ggplot() +
  geom_boxplot(aes(y = Wysokość_kredytu, fill = Przeznaczenie_kredytu)) +
  theme_bw() +
  labs(title = "20240508 - Wysokość zadłużenia, a jego przeznaczenie",
       x = "Przeznaczenie kredytu", y = "Wysokość zadłużenia [EUR]", fill = "Legenda:")
```

***

### 2.3.7. Okres kredytowania
```{r}
df_dane %>%
  ggplot() +
  geom_point(aes(x = Okres_kredytowania, y = Wysokość_kredytu), 
             color = string_kolor_punktu_danych_na_wykresach,
             size = integer_rozmiar_punktu_danych_na_wykresach) + 
  theme_bw() +
  labs(title = "20240508 - Wysokość kredytu = f(Okres kredytowania)", 
       x = "Okres kredytowania [miesiące]", y = "Wysokość kredytu [EUR]") +
  scale_x_continuous(breaks=seq(3, 78, by=3))

df_dane %>%
  ggplot() +
  geom_histogram(aes(x = Okres_kredytowania), 
                 fill = "steelblue",
                 color = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład okresu wysokości kredytowania", 
       x = "Okres kredytowania [miesiące]", y = "Występowanie") + 
  scale_x_continuous(breaks=seq(3, 78, by=3))

df_dane %>%
  ggplot() +
  geom_density(aes(x = Okres_kredytowania), 
               fill = "steelblue",
               color = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład okresu wysokości kredytowania", 
       x = "Okres kredytowania [miesiące]", y = "Występowanie") + 
  scale_x_continuous(breaks=seq(3, 78, by=3))
```

***

### 2.3.8. Przeznaczenie kredytu
```{r}
wektor_przeznaczenie_kredytu_w_badanej_probie <- table(df_dane$Przeznaczenie_kredytu)
names(wektor_przeznaczenie_kredytu_w_badanej_probie) <- c("Biznes [Liczba]",
                                                          "Samochód [Liczba]",
                                                          "AGD [Liczba]",
                                                          "Edukacja [Liczba]",
                                                          "Meble [Liczba]",
                                                          "RTV [Liczba]",
                                                          "Remont [Liczba]",
                                                          "Wakacje [Liczba]")

wektor_przeznaczenie_kredytu_w_badanej_probie_procenty <- 
  funkcja_konwersja_wartosci_wektora_na_procenty(wektor_przeznaczenie_kredytu_w_badanej_probie,1)
names(wektor_przeznaczenie_kredytu_w_badanej_probie_procenty) <- c("Biznes [%]",
                                                                   "Samochód [%]",
                                                                   "AGD [%]",
                                                                   "Edukacja [%]",
                                                                   "Meble [%]",
                                                                   "RTV [%]",
                                                                   "Remont [%]",
                                                                   "Wakacje [%]")
wektor_przeznaczenie_kredytu_w_badanej_probie
wektor_przeznaczenie_kredytu_w_badanej_probie_procenty

df_dane %>%
  ggplot() +
  geom_histogram(aes(x = Wiek, fill = Przeznaczenie_kredytu), 
                 alpha = 0.75, position = "dodge",
                 colour = "black", bins = 5) +
  theme_bw() +
  labs(title = "20240508 - Rozkład wieku Kredytobiorców z podziałem na przeznaczenie kredytów",
       x = "Wiek [lata]", y = "Występowanie", fill="Legenda:")

df_dane %>%
  ggplot() +
  geom_density(aes(x = Wiek, fill = Przeznaczenie_kredytu), 
                 alpha = 0.25,
                 colour = "black") +
  theme_bw() +
  labs(title = "20240508 - Rozkład wieku Kredytobiorców z podziałem na przeznaczenie kredytów",
       x = "Wiek [lata]", y = "Występowanie", fill="Legenda:")

df_dane %>%
  ggplot() +
  geom_jitter(aes(x = Wiek, y = Przeznaczenie_kredytu, col = Płeć),
              height = 0.2, 
              size = integer_rozmiar_punktu_danych_na_wykresach) +
  theme_bw() +
  labs(title = "20240508 - Przeznaczenie kredytu, a wiek Kredytobiorcy", 
       x = "Wiek [lata]", y = "Przeznaczenie kredytu", fill="Legenda:")

df_dane %>%
  ggplot() +
  geom_boxplot(aes(y = Wiek, fill = Przeznaczenie_kredytu)) +
  theme_bw() +
  labs(title = "20240508 - Rozkład wieku Kredytobiorców z podziałem na przeznaczenie kredytów", y = "Wiek [lata]", x = "Przeznaczenie kredytu", fill="Legenda:")
```

***

## 2.4. Podsumowanie EDA

Niniejsza sekcja zawiera podsumowanie oraz wnioski Eksploracyjnej Analizy Danych (EDA). Na podstawie przeprowadzonej EDA podjęta zostanie decyzja dot. wyboru zmiennej objaśnianej (Y) oraz objaśniających (X1, X2, X3, ...). 

W dalszej kolejności, wybrane zmienne posłużą budowie modeli regresyjnych przy użyciu technik uczenia maszynowego (ML).

***

### 2.4.1. Obserwacje i wnioski

Po wstępnej obróbce danych, w badanej próbie 67.8% niemieckich Kredytobiorców jest płci męskiej, a 32.2% to Kobiety. 

Wśród kredytobiorców, 75% procent (trzeci kwartyl) stanowią ludzie poniżej 40. roku życia, mediana wieku Kredytobiorców to 31.5 roku. Mężczyźni biorą kredyty później od Kobiet: 33 lata (mediana dla meżczyzn) oraz 28.5 lat (mediana dla Kobiet).

Najem i mieszkania własnościowe stanowią ponad połowę typów nieruchomości, w których żyją niemieccy Kredytobiorcy dla danej próby. Mieszkania socjalne są najmniej popularne (mniej niż połowa). Wśród młodych ludzi (< 30 lat) dominuje najem (1. pozycja) oraz mieszkania własnościowe (2. pozycja). Mediana wieku wszystkich wynajmujących to 27 lat, a mediana wieku właścicieli mieszkań to 30 lat.
Wśród osób wynajmujących mieszkania, połowa (kwartyle 1. oraz 3.) to osoby w wieku od 25 do 35 lat.
Wśród osób posiadających mieszkania na własność, widzimy szerszy przekrój wieku badanych: od 27. do 40. roku życia (kwartyle 1. oraz 3.). Ludzie od 35. do 55. roku życia żyją raczej w mieszkaniach socjalnych - mediana wieku zamieszkujących mieszkania socjalne to 45 lat, a pierwszy i trzeci kwartyl dla tej grupy społecznej mają wartości odpowiednio 35 oraz 55 lat.

Bez względu na rodzaj posiadanej nieruchomości (najem, własnościowe, socjalne), wszystkie grupy społeczne w badanej próbie mają niskie oszczędności (oceniono na podstawie zmiennych jakościowych). Mężczyźni w grupie posiadaczy mieszkań mają zauważalnie wyższe oszczędności niż Kobiety (oceniono na podstawie zmiennych jakościowych). 

Co ciekawe, bez względu na rodzaj posiadanej nieruchomości (najem, własnościowe, socjalne), wszystkie grupy społeczne mają również niskie zadłużenie (oceniono na podstawie zmiennych jakościowych). Najniższe zadłużenie cechuje najemców - kwartyl pierwszy i trzeci zadłużenia wynoszą: 2000EUR i 3000EUR, a mediana to 2500EUR. Osoby w mieszkaniach socjalnych są najbardziej zadłużone - kwartyl pierwszy i trzeci zadłużenia wynoszą w tym przypadku: 4000EUR i 7500EUR, a mediana to 4250EUR. \
Pod względem wysokości zadłużenia, najwięcej osób zadłużonych na sumy powyżej 7500EUR jest w grupie właścicieli mieszkań, a w dalszej kolejności wśród najemców. Osoby w mieszkaniach socjalnych są najczęściej zadłużone. Najemcy oraz posiadacze mieszkań zadłużają się rzadziej, lecz na wyższe sumy.

Wysokość oszczędności jest praktycznie niezależna od wieku Kredytobiorcy, a przytłaczająca większość badanych (78.9%) ma niskie oszczędności (oceniono na podstawie zmiennych jakościowych). Niskie lub umiarkowane oszczędności ma łącznie aż 91.2% niemieckich Kredytobiorców w badanej próbie.
		
Powyższe informacje na temat stanu oszczędności Kredytobiorców potwierdzają wyniki sald rachunków bieżących: 89,8% ma saldo niskie lub umiarkowane (oceniono na podstawie zmiennych jakościowych).
		
Najbardziej popularne okresy kredytowania to: 12, 24 oraz 36 miesięcy. Praktycznie wszystkie kredyty wydawane są na okres do 48 miesięcy.

Bez podziału na płeć Kredytobiorców, 50% kredytów (kwartyl 1. oraz 3.) jest o wartościach od 2000EUR do 4000EUR. Mediana wysokości kredytów to 2500EUR. Mniej niż 25% kredytów jest powyżej 5000EUR. \
W badanej próbie mężczyźni są zadłużeni na wyższe sumy niż Kobiety - kwartyle 1., 2. oraz 3. zadłużenia  meżczyzn to: 1750EUR, 2500EUR oraz 4500EUR, a w przypadku Kobiet wynoszą one: 1750EUR, 2000EUR oraz 3750EUR.

W ogólnym zarysie Kredytobiorcy zdają się ``przejadać'' kredyty na bieżącą konsumpcję: 33.1% przeznacza je na samochód, 25.3% na produkty RTV, a 20.5% na meble. Konsumpcja w badanej próbie stanowi więc łącznie 78.9% wszystkich kredytów. \
Jeśli chodzi o wysokość kredytów w funkcji ich przeznaczenia to Niemcy w badanej próbie najbardziej zadłużeni są na wakacje (kwartyle 1., 2. oraz 3. wynoszą: 5000EUR, 11000EUR oraz 15000EUR), edukację (kwartyle 1., 2. oraz 3. wynoszą: 1500EUR, 2000EUR oraz 6000EUR) oraz rozruch biznesu (kwartyle 1., 2. oraz 3. wynoszą: 2000EUR, 3000EUR oraz 5500EUR).

Krótki okres kredytowania (do 48 miesięcy) oraz fakt, że kredyty są głównie przeznaczane na bieżącą konsumpcję sugeruje, iż analizowana baza danych zawiera dane kredytów konsumenckich.

***

### 2.4.2. Koncepcja modelu

Wytrenowany zostanie model zależności płci kredytobiorców (zmienna objaśniana - Y) od pozostałych zmiennych objaśniających (X).

Na podstawie przeprowadzonej analizy EDA wyróżnić można następujące zależności zmiennych Y=f(X), z podziałem na dwie grupy pod względem mocy dyskryminacyjnej, [1]:

* Duża moc dyskyminacyjna:
    + Płeć = f(Wiek)
    + Płeć = f(Przeznaczenie kredytu)
    + Płeć = f(Nieruchomości)
* Niska moc dyskyminacyjna:
    + Płeć = f(Zatrudnienie)
    + Płeć = f(Oszczędności)
    + Płeć = f(Saldo bieżące)
    + Płeć = f(Okres kredytowania)
    + Płeć = f(Wysokość kredytu)

Tym samym, w kolejnym rozdziale zbudowane zostaną dwa modele uczenia maszynowego: jeden tylko dla zmiennych o dużej mocy dyskryminacyjnej i jeden dla zmiennych o zróżnicowanych mocach (wszystkie ww. zmienne objaśniające).

***

# 3. Modele ML

W niniejszym rozdziale wytrenowane oraz przetestowane zostaną modele uczenia maszynowego (ang. machine learning; skrót: ML).

Modele ML zostaną zbudowane z wykorzystaniem następujących technik:

* metoda kNN
* metoda drzew decyzyjnych
* metoda "random forest"

Jak wspomniano w sekcji 2.4.2., powyższe modele powstaną dla dwóch zestawów danych: 

* zbiór danych wykorzystujący tylko trzy zmienne objaśniajace (3X) o dużych mocach dyskryminacyjnych,
* pełny zbiór danych z siedmioma zmiennymi objaśniającymi (7X) o zróżnicowanych mocach dyskryminacyjnych.

W toku pracy optymalizowane będą wartości wybranych hiperparametrów modeli.

***

## 3.1. Wstępna konfiguracja
```{r}
### Ziarno dla wszystkich modeli:
set.seed(123)

### Konfiguracja kroswalidacji danych:
obiekt_kroswalidacji_danych <- trainControl(method = "repeatedcv", 
                                            number = 5, 
                                            repeats = 3)

### Budowa macierzy wynikowej ACSS:
macierz_podsumowania = matrix(c(1:18), ncol=3, byrow=TRUE)
colnames(macierz_podsumowania) <- c('Accuracy','Sensitivity','specificity')
rownames(macierz_podsumowania) <- c("Zestaw 3X | Model kNN",
                                    "Zestaw 3X | Model drzew decyzyjnych",
                                    "Zestaw 3X | Model 'Random Forest'",
                                    "Zestaw 7X | Model kNN",
                                    "Zestaw 7X | Model drzew decyzyjnych",
                                    "Zestaw 7X | Model 'Random Forest'")
macierz_podsumowania <- as.table(macierz_podsumowania)
```

***

## 3.2. Modele ML dla 3X

W niniejszej sekcji wytrenowano modele uczenia maszynowego ML dla zestawu danych z trzema zmiennymi objaśniającymi.

***

### 3.2.1. Przygotowanie danych
```{r}
### Przygotowanie danych - pozostawiam tylko zmienne:
# - Y - objaśnianą: 
#   - "Płeć"
# - X - objasniające: 
#   - "Wiek"
#   - "Nieruchomości"
#   - "Przeznaczenie_kredytu"

wektor_zachowaj_kolumny <- c("Płeć",
                             "Wiek", 
                             "Nieruchomości", 
                             "Przeznaczenie_kredytu")

df_dane_3_zmienne_objasniajace <- subset(df_dane, select = wektor_zachowaj_kolumny)

### Podział danych na uczące i testowe:
wektor_podzial_danych_uczacych <- createDataPartition(
  df_dane_3_zmienne_objasniajace$Płeć,
  p = 0.7,
  list = FALSE)

df_dane_uczace_3_zmienne_objasniajace <-
  df_dane_3_zmienne_objasniajace[wektor_podzial_danych_uczacych,]
df_dane_testowe_3_zmienne_objasniajace <- 
  df_dane_3_zmienne_objasniajace[-wektor_podzial_danych_uczacych,]
```

***

### 3.2.2. Model kNN
```{r}
### Budowa modelu wraz z optymalizacją hiperparametrów:
obiekt_modelu_kNN_3_zmienne_objasniajace <- 
  train(Płeć ~.,
        data = df_dane_uczace_3_zmienne_objasniajace,   
        method = "knn",
        preProc = c("center", "scale"),
        trControl = obiekt_kroswalidacji_danych,
        tuneGrid = data.frame(k = c(5:11))
        )

### Prognoza:
prognoza_modelu_kNN_3_zmienne_objasniajace <- 
  predict(obiekt_modelu_kNN_3_zmienne_objasniajace, 
          df_dane_testowe_3_zmienne_objasniajace)

### Macierz pomyłek:
macierz_pomylek_modelu_kNN_3_zmienne_objasniajace <- 
  confusionMatrix(prognoza_modelu_kNN_3_zmienne_objasniajace, 
                  df_dane_testowe_3_zmienne_objasniajace$Płeć)

### Podsumowanie i podział wyników:
tabela_wynikow_modelu_kNN_3_zmienne_objasniajace <- 
  macierz_pomylek_modelu_kNN_3_zmienne_objasniajace[2]
float_accuracy_modelu_kNN_3_zmienne_objasniajace <- 
  macierz_pomylek_modelu_kNN_3_zmienne_objasniajace[3]$overall[1]
float_accuracy_modelu_kNN_3_zmienne_objasniajace
float_senstivity_modelu_kNN_3_zmienne_objasniajace <- 
  macierz_pomylek_modelu_kNN_3_zmienne_objasniajace[4]$byClass[1]
float_specificity_modelu_kNN_3_zmienne_objasniajace <- 
  macierz_pomylek_modelu_kNN_3_zmienne_objasniajace[4]$byClass[2]

### Przypisanie wyników do macierzy podsumowania:
macierz_podsumowania[1,1] <- float_accuracy_modelu_kNN_3_zmienne_objasniajace
macierz_podsumowania[1,2] <- float_senstivity_modelu_kNN_3_zmienne_objasniajace
macierz_podsumowania[1,3] <- float_specificity_modelu_kNN_3_zmienne_objasniajace
```

***

### 3.2.3. Model drzew decyzyjnych
```{r}
### Budowa modelu wraz z optymalizacją hiperparametrów:
obiekt_modelu_drzew_decyzyjnych_3_zmienne_objasniajace <- 
  train(Płeć ~.,
  data = df_dane_uczace_3_zmienne_objasniajace,
  method = "rpart",
  preProc = c("center", "scale"),
  trControl = obiekt_kroswalidacji_danych,
  tuneLength = 5)
                                     
### Prognoza:
prognoza_modelu_drzew_decyzyjnych_3_zmienne_objasniajace <- 
  predict(obiekt_modelu_drzew_decyzyjnych_3_zmienne_objasniajace,
          df_dane_testowe_3_zmienne_objasniajace)

### Macierz pomyłek:
macierz_pomylek_modelu_drzew_decyzyjnych_3_zmienne_objasniajace <- 
  confusionMatrix(
    prognoza_modelu_drzew_decyzyjnych_3_zmienne_objasniajace,
    df_dane_testowe_3_zmienne_objasniajace$Płeć)

### Podsumowanie i podział wyników:
tabela_wynikow_modelu_drzew_decyzyjnych_3_zmienne_objasniajace <- 
  macierz_pomylek_modelu_drzew_decyzyjnych_3_zmienne_objasniajace[2]
float_accuracy_modelu_drzew_decyzyjnych_3_zmienne_objasniajace <- 
  macierz_pomylek_modelu_drzew_decyzyjnych_3_zmienne_objasniajace[3]$overall[1]
float_senstivity_modelu_drzew_decyzyjnych_3_zmienne_objasniajace <-
  macierz_pomylek_modelu_drzew_decyzyjnych_3_zmienne_objasniajace[4]$byClass[1]
float_specificity_modelu_drzew_decyzyjnych_3_zmienne_objasniajace <-
  macierz_pomylek_modelu_drzew_decyzyjnych_3_zmienne_objasniajace[4]$byClass[2]

### Przypisanie wyników do macierzy podsumowania:
macierz_podsumowania[2,1] <- float_accuracy_modelu_drzew_decyzyjnych_3_zmienne_objasniajace
macierz_podsumowania[2,2] <- float_senstivity_modelu_drzew_decyzyjnych_3_zmienne_objasniajace
macierz_podsumowania[2,3] <- float_specificity_modelu_drzew_decyzyjnych_3_zmienne_objasniajace
```

***

### 3.2.4. Model "random forest"
```{r}
### Budowa modelu wraz z optymalizacją hiperparametrów:
obiekt_modelu_random_forest_3_zmienne_objasniajace <- 
  train(Płeć ~.,
  data = df_dane_uczace_3_zmienne_objasniajace,
  method = "rf",
  preProc = c("center", "scale"),
  trControl = obiekt_kroswalidacji_danych,
  tuneLength = 5)

### Prognoza:
prognoza_modelu_random_forest_3_zmienne_objasniajace <- 
  predict(obiekt_modelu_random_forest_3_zmienne_objasniajace,
          df_dane_testowe_3_zmienne_objasniajace)

### Macierz pomyłek:
macierz_pomylek_modelu_random_forest_3_zmienne_objasniajace <- 
  confusionMatrix(
    prognoza_modelu_random_forest_3_zmienne_objasniajace,
    df_dane_testowe_3_zmienne_objasniajace$Płeć)

### Podsumowanie i podział wyników:
tabela_wynikow_modelu_random_forest_3_zmienne_objasniajace <- 
  macierz_pomylek_modelu_random_forest_3_zmienne_objasniajace[2]
float_accuracy_modelu_random_forest_3_zmienne_objasniajace <- 
  macierz_pomylek_modelu_random_forest_3_zmienne_objasniajace[3]$overall[1]
float_senstivity_modelu_random_forest_3_zmienne_objasniajace <-
  macierz_pomylek_modelu_random_forest_3_zmienne_objasniajace[4]$byClass[1]
float_specificity_modelu_random_forest_3_zmienne_objasniajace <-
  macierz_pomylek_modelu_random_forest_3_zmienne_objasniajace[4]$byClass[2]

### Przypisanie wyników do macierzy podsumowania:
macierz_podsumowania[3,1] <- float_accuracy_modelu_random_forest_3_zmienne_objasniajace
macierz_podsumowania[3,2] <- float_senstivity_modelu_random_forest_3_zmienne_objasniajace
macierz_podsumowania[3,3] <- float_specificity_modelu_random_forest_3_zmienne_objasniajace
```

***

## 3.3. Modele ML dla 7X

W niniejszej sekcji wytrenowano modele uczenia maszynowego ML dla zestawu danych z siedmioma zmiennymi objaśniającymi.

***

### 3.3.1. Przygotowanie danych
```{r}
### Przygotowanie danych - pozostawiam tylko zmienne:
# - Y - objaśnianą: 
#   - "Płeć"
# - X - objasniające: 
#   - "Wiek"
#   - "Zatrudnienie"
#   - "Nieruchomości"
#   - "Rachunek_oszczędnościowy "
#   - "Rachunek_bieżący"
#   - "Przeznaczenie_kredytu"
#   - "Okres_kredytowania"
#   - "Wysokość_kredytu"

wektor_zachowaj_kolumny <- c("Płeć",
                             "Wiek", 
                             "Zatrudnienie",
                             "Nieruchomości",
                             "Rachunek_oszczędnościowy",
                             "Rachunek_bieżący",
                             "Przeznaczenie_kredytu",
                             "Okres_kredytowania",
                             "Wysokość_kredytu")

df_dane_7_zmiennych_objasniajacych <- subset(df_dane, select = wektor_zachowaj_kolumny)

### Podział danych na uczące i testowe:
wektor_podzial_danych_uczacych <- createDataPartition(
  df_dane_7_zmiennych_objasniajacych$Płeć,
  p = 0.7,
  list = FALSE)

df_dane_uczace_7_zmiennych_objasniajacych <-
  df_dane_7_zmiennych_objasniajacych[wektor_podzial_danych_uczacych,]
df_dane_testowe_7_zmiennych_objasniajacych <- 
  df_dane_7_zmiennych_objasniajacych[-wektor_podzial_danych_uczacych,]
```

***

### 3.3.2. Model kNN
```{r}
### Budowa modelu wraz z optymalizacją hiperparametrów:
obiekt_modelu_kNN_7_zmiennych_objasniajacych <- 
  train(Płeć ~.,
        data = df_dane_uczace_7_zmiennych_objasniajacych,   
        method = "knn",
        preProc = c("center", "scale"),
        trControl = obiekt_kroswalidacji_danych,
        tuneGrid = data.frame(k = c(5:11))
  )

### Prognoza:
prognoza_modelu_kNN_7_zmiennych_objasniajacych <- 
  predict(obiekt_modelu_kNN_7_zmiennych_objasniajacych, 
          df_dane_testowe_7_zmiennych_objasniajacych)

### Macierz pomyłek:
macierz_pomylek_modelu_kNN_7_zmiennych_objasniajacych <- 
  confusionMatrix(prognoza_modelu_kNN_7_zmiennych_objasniajacych, 
                  df_dane_testowe_7_zmiennych_objasniajacych$Płeć)

### Podsumowanie i podział wyników:
tabela_wynikow_modelu_kNN_7_zmiennych_objasniajacych <- 
  macierz_pomylek_modelu_kNN_7_zmiennych_objasniajacych[2]
float_accuracy_modelu_kNN_7_zmiennych_objasniajacych <- 
  macierz_pomylek_modelu_kNN_7_zmiennych_objasniajacych[3]$overall[1]
float_senstivity_modelu_kNN_7_zmiennych_objasniajacych <- 
  macierz_pomylek_modelu_kNN_7_zmiennych_objasniajacych[4]$byClass[1]
float_specificity_modelu_kNN_7_zmiennych_objasniajacych <- 
  macierz_pomylek_modelu_kNN_7_zmiennych_objasniajacych[4]$byClass[2]

### Przypisanie wyników do macierzy podsumowania:
macierz_podsumowania[4,1] <- float_accuracy_modelu_kNN_7_zmiennych_objasniajacych
macierz_podsumowania[4,2] <- float_senstivity_modelu_kNN_7_zmiennych_objasniajacych
macierz_podsumowania[4,3] <-float_specificity_modelu_kNN_7_zmiennych_objasniajacych
```

***

### 3.3.3. Model drzew decyzyjnych
```{r}
### Budowa modelu wraz z optymalizacją hiperparametrów:
obiekt_modelu_drzew_decyzyjnych_7_zmiennych_objasniajacych <- 
  train(Płeć ~.,
        data = df_dane_uczace_7_zmiennych_objasniajacych,
        method = "rpart",
        preProc = c("center", "scale"),
        trControl = obiekt_kroswalidacji_danych,
        tuneLength = 5)

### Prognoza:
prognoza_modelu_drzew_decyzyjnych_7_zmiennych_objasniajacych <- 
  predict(obiekt_modelu_drzew_decyzyjnych_7_zmiennych_objasniajacych,
          df_dane_testowe_7_zmiennych_objasniajacych)

### Macierz pomyłek:
macierz_pomylek_modelu_drzew_decyzyjnych_7_zmiennych_objasniajacych <- 
  confusionMatrix(
    prognoza_modelu_drzew_decyzyjnych_7_zmiennych_objasniajacych,
    df_dane_testowe_7_zmiennych_objasniajacych$Płeć)

### Podsumowanie i podział wyników:
tabela_wynikow_modelu_drzew_decyzyjnych_7_zmiennych_objasniajacych <- 
  macierz_pomylek_modelu_drzew_decyzyjnych_7_zmiennych_objasniajacych[2]
float_accuracy_modelu_drzew_decyzyjnych_7_zmiennych_objasniajacych <- 
  macierz_pomylek_modelu_drzew_decyzyjnych_7_zmiennych_objasniajacych[3]$overall[1]
float_senstivity_modelu_drzew_decyzyjnych_7_zmiennych_objasniajacych <-
  macierz_pomylek_modelu_drzew_decyzyjnych_7_zmiennych_objasniajacych[4]$byClass[1]
float_specificity_modelu_drzew_decyzyjnych_7_zmiennych_objasniajacych <-
  macierz_pomylek_modelu_drzew_decyzyjnych_7_zmiennych_objasniajacych[4]$byClass[2]

### Przypisanie wyników do macierzy podsumowania:
macierz_podsumowania[5,1] <- float_accuracy_modelu_drzew_decyzyjnych_7_zmiennych_objasniajacych
macierz_podsumowania[5,2] <- float_senstivity_modelu_drzew_decyzyjnych_7_zmiennych_objasniajacych
macierz_podsumowania[5,3] <- float_specificity_modelu_drzew_decyzyjnych_7_zmiennych_objasniajacych
```

***

### 3.3.4. Model "random forest"
```{r}
### Budowa modelu wraz z optymalizacją hiperparametrów:
obiekt_modelu_random_forest_7_zmiennych_objasniajacych <- 
  train(Płeć ~.,
        data = df_dane_uczace_7_zmiennych_objasniajacych,
        method = "rf",
        preProc = c("center", "scale"),
        trControl = obiekt_kroswalidacji_danych,
        tuneLength = 5)

### Prognoza:
prognoza_modelu_random_forest_7_zmiennych_objasniajacych <- 
  predict(obiekt_modelu_random_forest_7_zmiennych_objasniajacych,
          df_dane_testowe_7_zmiennych_objasniajacych)

### Macierz pomyłek:
macierz_pomylek_modelu_random_forest_7_zmiennych_objasniajacych <- 
  confusionMatrix(
    prognoza_modelu_random_forest_7_zmiennych_objasniajacych,
    df_dane_testowe_7_zmiennych_objasniajacych$Płeć)

### Podsumowanie i podział wyników:
tabela_wynikow_modelu_random_forest_7_zmiennych_objasniajacych <- 
  macierz_pomylek_modelu_random_forest_7_zmiennych_objasniajacych[2]
float_accuracy_modelu_random_forest_7_zmiennych_objasniajacych <- 
  macierz_pomylek_modelu_random_forest_7_zmiennych_objasniajacych[3]$overall[1]
float_senstivity_modelu_random_forest_7_zmiennych_objasniajacych <-
  macierz_pomylek_modelu_random_forest_7_zmiennych_objasniajacych[4]$byClass[1]
float_specificity_modelu_random_forest_7_zmiennych_objasniajacych <-
  macierz_pomylek_modelu_random_forest_7_zmiennych_objasniajacych[4]$byClass[2]

### Przypisanie wyników do macierzy podsumowania:
macierz_podsumowania[6,1] <- 
  float_accuracy_modelu_random_forest_7_zmiennych_objasniajacych
macierz_podsumowania[6,2] <- float_senstivity_modelu_random_forest_7_zmiennych_objasniajacych
macierz_podsumowania[6,3] <- float_specificity_modelu_random_forest_7_zmiennych_objasniajacych
```

***

# 4. Podsumowanie

***

## 4.1. Tabele prognoz

Poniżej przedstawiono tabele danych prognozowanych vs. dane testowe dla wszystkich trzech modeli (kNN, drzewa decyzyjne oraz "random forest") wytrenowanych z wykorzystaniem dwóch różnych zestawów danych wejściowych (trzy zmienne objaśniające lub siedem zmiennych objaśniających).

Wyniki pogrupowano względem typów modeli ML celem umożliwienia porównania różnic między dwoma zestawami danych wejściowych.

Model kNN:
```{r}
# Zestaw danych: 3X
tabela_wynikow_modelu_kNN_3_zmienne_objasniajace
# Zestaw danych: 7X
tabela_wynikow_modelu_kNN_7_zmiennych_objasniajacych
```

Model drzew decyzyjnych:
```{r}
### Zestaw danych: 3X
tabela_wynikow_modelu_drzew_decyzyjnych_3_zmienne_objasniajace
### Zestaw danych: 7X
tabela_wynikow_modelu_drzew_decyzyjnych_7_zmiennych_objasniajacych
```

Model "random forest":
```{r}
### Zestaw danych: 3X
tabela_wynikow_modelu_random_forest_3_zmienne_objasniajace
### Zestaw danych: 7X
tabela_wynikow_modelu_random_forest_7_zmiennych_objasniajacych
```

***

## 4.2. Macierz podsumowania

Poniżej przedstawiono macierz podsumowania wybranych parametrów uczenia maszynowego.

W przeciwieństwie do punktu 4.1. tym razem wyniki pogrupowano względem liczby zmiennych objaśniających.

```{r}
round(macierz_podsumowania,2)
```

***

## 4.3. Obserwacje i wnioski

Ogólna dokładność ("accuracy") wszystkich trzech modeli jest do siebie zbliżona, ale jej wartość jest przeciętna i oscyluje w granicach 70-74%.

Jak widać na podstawie zestawienia tabel w sekcji 4.1. oraz wyników zebranych w macierzy sekcji 4.2. czułość ("sensitivity") przewidywania płci Kobiet jest bardzo niska dla wszystkich trzech modeli. Być może jest to spowodowane faktem, iż Kobiety i mężczyźni są nierównomiernie reprezentowani w próbie - mężczyzni stanowią bowiem dwie trzecie próby.

Dokładność ("accuracy") oraz specyficzność ("specificity") są niezależne od zestawu danych wejściowych (zestawy 3X i 7X), co sugeruje, że w przypadku tych dwóch parametrów wpływ zmiennych o niskiej mocy dyskryminacyjnej jest - co w pełni logiczne - niski, [1].\
Analizując skuteczność trenowania modeli kNN oraz "random forest" dla dwóch zestawów danych (3X oraz 7X), widzimy, że czułość ("sensitivity") jest dwukrotnie wyższa w przypadku zastosowania zestawu danych tylko ze zmiennymi o dużych mocach dyskryminacyjnych (okrojony zestaw 3X). Powyższe wnioski sugerują, iż wykorzystanie zestawu danych o zróżnicowanych mocach dyskryminacyjnych (zestaw 7X) nie jest korzystne w procesie uczenia maszynowego. Proces ten powinien być więc prowadzony tylko z użyciem danych o dużych mocach dyskryminacyjnych. Innymi słowy, dane o niskich mocach dyskryminacyjnych stanowią szum i powodują spadek czułości.\
Co ciekawe, w przeciwieństwie do modeli kNN oraz "random forest", model drzew decyzyjnych jest nieczuły na zróżnicowanie mocy dyskryminacyjnych dwóch zestawów uczących.

W toku prac stwierdzono, że użycie wszystkich danych - włączając w to dane niepełne (N/A) - nie poprawiłoby w wymierny sposób jakości uczenia modeli.

Podsumowując, model ML wytrenowany przy użyciu techniki drzew decyzyjnych jest najbardziej dokładnym spośród wszystkich trzech przetestowanych modeli. Dodatkowo i co warte podkreślenia, w przypadku obecnych danych skuteczność tego modelu jest niezależna od liczby zmiennych objaśniajacych oraz zróżnicowania ich mocy dyskryminacyjnych. \
Zmienne objaśniające o niskiej mocy dyskryminacyjnej nie tylko nie wpływają na poprawę jakości uczenia wybranych trzech modeli, lecz skutkują pogorszeniem skuteczności uczenia.

***

# 5. Literatura

[1] - dr Jacek Wolak, wykład przedmiotu ``Machine Learning'' studiów podyplomowych "Metody Statystycznej Analizy Danych - edycja IX", Akademia Górniczo-Hutnicza w Krakowie, semestr letni 2024.